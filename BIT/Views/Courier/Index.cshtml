@using BIT.DataStuff
@using BIT.Interfaces
@using Microsoft.AspNetCore.Identity
@using BIT.Areas.Identity.Data
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject IAllOrders OrderBase
@inject IAllCouriers CourBase

@{
    string name = null;
}
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }

    th {
        background-color: #f2f2f2;
    }
</style>

@foreach (var cour in CourBase.Couriers)
{
    if (cour.UserId == UserManager.GetUserId(User))
    {
        name = cour.Name;
        <h3> Готові працювати? @cour.ReadyToWork</h3>
    }
}

<table>
    <thead>
        <tr>
            <th>Страва</th>
            <th>Кількість</th>
            <th>Клієнт</th>
            <th>Номер телефону</th>
            <th>Адреса</th>
            <th>Дата</th>
            <th>Сума</th>
            <th>Коментар</th>
            <th>Спосіб оплати</th>
            <th>Статус</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in OrderBase.Orders)
        {
            if (order.Courier == name)
            {
                <tr>
                    <td>@order.ProductName</td>
                    <td>@order.Quanity</td>
                    <td>@order.CustomerName</td>
                    <td>@order.Phonenumber</td>
                    <td>@order.ShippingAddress</td>
                    <td>@order.OrderDate</td>
                    <td>@order.TotalAmount</td>
                    <td>@order.Notes</td>
                    <td>@order.PaymentMethod</td>
                    <td>@order.Status</td>
                    @if (order.Status == "New")
                    {
                        <td>
                            <form method="post" action="/Courier/UpdateStatus">
                                <input type="hidden" name="ordId" value="@order.Id" />
                                <select name="newStatus">
                                    <option value="InProcess">In Process</option>
                                    <option value="Delivered">Delivered</option>                                    
                                </select>
                                <button type="submit" class="btn btn-success">Зробити</button>
                            </form>
                        </td>
                        <td>
                            <form method="post" action="/Courier/RefuseOrder">
                                <input type="hidden" name="ordId" value="@order.Id" />
                                <button type="submit" class="btn btn-success">Відхилити замовлення</button>
                            </form>
                        </td>
                    }
                </tr>
            }
        }
    </tbody>
</table>

@if (User.IsInRole("Courier"))
{
    <form method="post" action="/Courier/OnWork">    
        <input type="hidden" name="CourUserId" value="@UserManager.GetUserId(User)" />    
        <button type="submit" class="btn btn-success">Вийти на роботу</button>
    </form>

    <form method="post" action="/Courier/EndWork">
        <input type="hidden" name="CourUserId" value="@UserManager.GetUserId(User)" />
        <button type="submit" class="btn btn-success">Завершити робочий день</button>
    </form>
}
