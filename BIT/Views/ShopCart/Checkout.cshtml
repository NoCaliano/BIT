<h2>Checkout Page</h2>


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.12/signalr.min.js"></script>

<style>
    /* Стилі для контейнера товару і форми */
    .checkout-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 20px; /* Додайте відступи */
    }

    .cart-container {
        width: 70%; /* Збільшити ширину для відображення товарів */
    }

    .form-container {
        width: 28%; /* Зменшити ширину для відображення форми */
    }

    /* Стилі для товарів у кошику */
    .cart-item {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
        text-align: center;
    }

    .dish-image {
        max-width: 100px;
        max-height: 100px;
        margin-bottom: 5px;
    }

    .dish-name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .dish-details {
        font-size: 14px;
        margin-bottom: 5px;
    }

    .quantity-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }

    /* Стилі для загальної суми замовлення */
    .grand-total {
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
    }

    /* Загальні стилі для кнопок */
    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    /* Додайте цей код до вашого стилевого файлу або внесіть його в блок  у вашому файлі */
    #checkout-button {
        display: none;
    }




    /* Додаткові стилі за бажанням */
</style>

<div class="checkout-container">
    <div class="cart-container" id="cart-container">
        <!-- Додайте код для виведення товарів у кошику -->
    </div>

    <aside class="form-container" id="form-container">
        <!-- Додайте код для виведення форми -->
    </aside>
</div>

<script>
    $(document).ready(function () {
        // Завантаження часткового представлення "_CartOrder" в #form-container
        function loadCartOrder() {
            $.ajax({
                url: '/ShopCart/CartForm',
                type: 'GET',
                success: function (data) {
                    $('#form-container').html(data);
                },
                error: function () {
                    console.error('Failed to load CartForm');
                }
            });
        }

        // Завантаження часткового представлення "PartCart" в #cart-container
        function loadMyCart() {
            $.ajax({
                url: '/ShopCart/PartCart',
                type: 'GET',
                success: function (data) {
                    $('#cart-container').html(data);
                },
                error: function () {
                    console.error('Failed to load PartCart');
                }
            });
        }

        // Відправка форми через Ajax при натисканні кнопки
        $('#form-container').on('submit', 'form', function (e) {
            e.preventDefault(); // Запобігає стандартному поданню форми
            var form = $(this);

            $.ajax({
                url: form.attr('action'),
                type: form.attr('method'),
                data: form.serialize(),
                success: function (data) {
                    // Якщо сервер повертає HTML з помилками валідації, оновіть контейнер форми
                    if ($(data).find('.field-validation-error').length > 0) {
                        $('#form-container').html(data);
                    } else {
                        // Ваш код для випадку успішної валідації
                        // Додайте логіку, яку ви хочете виконати при успішному підтвердженні форми
                        loadMyCart(); // Оновити відображення товарів
                        // Додайте додаткову логіку тут

                        // Наприклад, очистити поля форми
                        window.location.href = '/Order/Thanks';
                    }
                },
                error: function () {
                    console.error('Failed to submit form');
                }
            });
        });

        // Завантаження форми та товарів при завантаженні сторінки
        loadCartOrder();
        loadMyCart();
    });
</script>

<script>
    var connection = new signalR.HubConnectionBuilder().withUrl("/cartHub").build();

    connection.on("CartUpdated", function () {
        onCartUpdated();
    });

    connection.start().then(function () {
        console.log("Connected to CartHub");
    }).catch(function (err) {
        console.error("Error connecting to CartHub: " + err.toString());
    });

    function onCartUpdated() {
        console.log('CartUpdated handler called');
        $.ajax({
            url: '/ShopCart/PartCart',
            type: 'GET',
            success: function (cartData) {
                $('#cart-container').html(cartData);
            },
            error: function () {
                console.error('Failed to load PartCart');
            }
        });

        // Оновлення форми
        $.ajax({
            url: '/ShopCart/CartForm',
            type: 'GET',
            success: function (formData) {
                $('#form-container').html(formData);
            },
            error: function () {
                console.error('Failed to load CartForm');
            }
        });
    }
</script>

